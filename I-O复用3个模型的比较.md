---
title: I/O复用3个模型的比较
date: 2017-11-16 16:25:40
tags: [linux,网络编程]
categories: IPC进程通信
comments: true
---
### 前言：
***前面分析了I/O复用的3种模型，分别是select，poll，epoll，它们各有优缺点，并且应用广泛，今天就来分析一下他们的异同。***

### 开场：
**分析之前还是讲一讲I/O复用在网络程序下的适用场合：**
1. 服务器同时监听socket和连接socket。
2. 服务器端同时处理多个socket。
3. 客户端程序同时处理用户输入和网络连接。
4. 服务器同时处理TCP和UDP请求。
5. 服务器监听多个端口，或者处理多个服务。
**<br>I/O复用函数本身是阻塞的，它们必须顺序处理每个就绪的文件描述符，要想实现并发执行，要用到多线程/多进程编程。<font color = red>但I/O复用的优势也是在此,不必创建大量进程或者线程，也不必去维护它们，大大节约系统资源。</font>**

### 渐进：
***<font color = blue size = 4>三者的共同点：</font>***
* 这3种模型都能同时监听多个文件描述符，他们等待由timeout参数指定的超时时间，直到一个或者多个文件描述符上有时间就绪时返回，返回就绪的数量。
* 3者都是同步I/O模型，即在监听事件就绪后也需要自己来负责读写。
* 3者都通过某种结构体变量来告知内核监听哪些文件描述符上的哪些事件，并使用该结构体类型的参数来获取内核处理的结果。

### 高潮：
***<font color = blue size = 4>三者的区别：</font>***
* poll、select是有事件就绪后就轮询所有的结构体数组中的文件描述符，看是否发生了感兴趣的事件。并将其中就绪的文件描述符返回给用户程序**而epoll是有事件就绪后内核事件表将就绪事件放到一个结构体数组中，仅仅轮询这些就绪事件。即epoll_wait采用回调的方式，内核检测到就绪的文件描述符后，就触发回调函数，回调函数就将该文件描述符上对应的事件插入内核就绪事件队列。最后在适当时间将内容拷贝到用户空间。**
* select参数类型fd_set 没有将文件描述符和事件进行绑定，它仅仅是一个文件描述符集合。而epoll、poll是将文件描述符和事件放入一个结构体中，实现了绑定。
* epoll最大的区别是实现了用户注册事件和内核检测就绪事件的分离，搜索就绪事件只搜索返回的就绪事件。epoll是通过内核与用户空间mmap同一块内存实现的。而select、poll需要轮询所有文件描述符或者其一一对应的注册事件。
* epoll适用于连接数量多，但活跃链接少的情况。select适用于并发量不高，且活跃链接多的情况。
* 另外还有几个小区别，请看下表：
  <br>![图1](I-O复用3个模型的比较\1.png)
  
  ## 尾声
  ***<font color = green size = 4>浅析三者的工作流程：</font>***
  
  